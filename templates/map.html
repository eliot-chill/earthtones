<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <title>EarthTones</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans+SC:300i,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  
  <body>
    <div  id="container">
    <div class="left" id="map-container">
    <div id="map">
    <script>
      //var arduino_json = {{ arduinoList|tojson }};
      $('.notification-form').on('submit', function(e) {
        e.preventDefault();
        $.ajax({
            type: 'post',
            url: '/addPhone',
            data: $('form').serialize(),
            success: function () {
              alert('form was submitted');
            }
          });
        console.log(this);
      });

      var arduino_json = [{'arduinoID': 'arduino1', 'lat': -37.090335, 'lng': 149.370666, 'temp': '19.70', 'hum': '44.80'}, {'arduinoID': 'arduino2', 'lat': -37.094532, 'lng': 149.379464, 'temp': '21.30', 'hum': '48.70'}, {'arduinoID': 'arduino3', 'lat': -37.106642, 'lng': -210.42642, 'temp': 18.4, 'hum': 63.77}, {'arduinoID': 'arduino4', 'lat': -37.365044, 'lng': -210.477937, 'temp': 23.67, 'hum': 37.17}, {'arduinoID': 'arduino5', 'lat': -37.382563, 'lng': -210.591309, 'temp': 20.66, 'hum': 43.58}, {'arduinoID': 'arduino6', 'lat': -37.296688, 'lng': -210.58793, 'temp': 18.31, 'hum': 41.61}, {'arduinoID': 'arduino7', 'lat': -37.437812, 'lng': -210.908871, 'temp': 19.18, 'hum': 32.19}, {'arduinoID': 'arduino8', 'lat': -37.357912, 'lng': -210.687894, 'temp': 22.49, 'hum': 35.04}, {'arduinoID': 'arduino9', 'lat': -36.985368, 'lng': -210.717538, 'temp': 22.26, 'hum': 35.55}, {'arduinoID': 'arduino10', 'lat': -37.028467, 'lng': -210.633961, 'temp': 23.13, 'hum': 59.39}, {'arduinoID': 'arduino11', 'lat': -36.958098, 'lng': -210.63409, 'temp': 22.68, 'hum': 65.49}, {'arduinoID': 'arduino12', 'lat': -37.266931, 'lng': -210.940167, 'temp': 22.12, 'hum': 32.67}, {'arduinoID': 'arduino13', 'lat': -37.311437, 'lng': -210.689552, 'temp': 22.35, 'hum': 31.47}, {'arduinoID': 'arduino14', 'lat': -37.160689, 'lng': -210.380634, 'temp': 17.27, 'hum': 38.85}, {'arduinoID': 'arduino15', 'lat': -37.148948, 'lng': -210.458343, 'temp': 22.09, 'hum': 33.64}, {'arduinoID': 'arduino16', 'lat': -36.981081, 'lng': -210.641294, 'temp': 17.28, 'hum': 42.51}, {'arduinoID': 'arduino17', 'lat': -37.004491, 'lng': -210.962118, 'temp': 18.52, 'hum': 34.75}, {'arduinoID': 'arduino18', 'lat': -37.050631, 'lng': -210.944412, 'temp': 18.51, 'hum': 38.15}, {'arduinoID': 'arduino19', 'lat': -37.250237, 'lng': -210.547218, 'temp': 20.85, 'hum': 49.9}, {'arduinoID': 'arduino20', 'lat': -37.074322, 'lng': -210.591528, 'temp': 18.49, 'hum': 47.94}, {'arduinoID': 'arduino21', 'lat': -37.33643, 'lng': -210.869981, 'temp': 22.75, 'hum': 61.29}, {'arduinoID': 'arduino22', 'lat': -37.231966, 'lng': -210.487148, 'temp': 17.55, 'hum': 49.9}, {'arduinoID': 'arduino23', 'lat': -37.057871, 'lng': -210.83345, 'temp': 17.59, 'hum': 33.52}, {'arduinoID': 'arduino24', 'lat': -37.149707, 'lng': -210.655728, 'temp': 22.18, 'hum': 35.23}, {'arduinoID': 'arduino25', 'lat': -37.334436, 'lng': -210.367411, 'temp': 22.37, 'hum': 58.63}, {'arduinoID': 'arduino26', 'lat': -37.439502, 'lng': -210.853823, 'temp': 19.88, 'hum': 43.62}, {'arduinoID': 'arduino27', 'lat': -37.088174, 'lng': -210.34961, 'temp': 19.75, 'hum': 63.66}, {'arduinoID': 'arduino28', 'lat': -37.295808, 'lng': -210.904363, 'temp': 23.69, 'hum': 45.22}, {'arduinoID': 'arduino29', 'lat': -37.162425, 'lng': -210.365936, 'temp': 18.91, 'hum': 34.33}, {'arduinoID': 'arduino30', 'lat': -37.403859, 'lng': -210.827274, 'temp': 17.94, 'hum': 60.78}, {'arduinoID': 'arduino31', 'lat': -37.169742, 'lng': -210.670705, 'temp': 21.29, 'hum': 38.83}, {'arduinoID': 'arduino32', 'lat': -37.239125, 'lng': -210.355196, 'temp': 17.87, 'hum': 42.9}, {'arduinoID': 'arduino33', 'lat': -37.373377, 'lng': -210.962922, 'temp': 23.1, 'hum': 34.57}, {'arduinoID': 'arduino34', 'lat': -37.319524, 'lng': -210.971615, 'temp': 18.46, 'hum': 56.53}, {'arduinoID': 'arduino35', 'lat': -36.951306, 'lng': -210.776409, 'temp': 22.96, 'hum': 58.45}, {'arduinoID': 'arduino36', 'lat': -37.376916, 'lng': -210.335468, 'temp': 19.59, 'hum': 68.28}, {'arduinoID': 'arduino37', 'lat': -36.987239, 'lng': -210.918115, 'temp': 20.62, 'hum': 52.82}, {'arduinoID': 'arduino38', 'lat': -37.222801, 'lng': -210.91151, 'temp': 22.63, 'hum': 52.97}, {'arduinoID': 'arduino39', 'lat': -37.431118, 'lng': -210.632951, 'temp': 22.35, 'hum': 60.46}, {'arduinoID': 'arduino40', 'lat': -37.113653, 'lng': -210.852767, 'temp': 23.1, 'hum': 67.7}, {'arduinoID': 'arduino41', 'lat': -36.949245, 'lng': -210.42058, 'temp': 20.92, 'hum': 66.47}, {'arduinoID': 'arduino42', 'lat': -37.21819, 'lng': -210.659061, 'temp': 18.13, 'hum': 38.87}, {'arduinoID': 'arduino43', 'lat': -37.392873, 'lng': -210.983481, 'temp': 17.25, 'hum': 42.56}, {'arduinoID': 'arduino44', 'lat': -37.141996, 'lng': -210.822177, 'temp': 23.09, 'hum': 44.59}, {'arduinoID': 'arduino45', 'lat': -37.344921, 'lng': -210.56188, 'temp': 22.48, 'hum': 34.17}, {'arduinoID': 'arduino46', 'lat': -37.403068, 'lng': -210.913301, 'temp': 22.72, 'hum': 52.11}, {'arduinoID': 'arduino47', 'lat': -37.175281, 'lng': -210.399924, 'temp': 19.86, 'hum': 54.08}, {'arduinoID': 'arduino48', 'lat': -37.034654, 'lng': -210.765526, 'temp': 18.63, 'hum': 58.48}, {'arduinoID': 'arduino49', 'lat': -37.270804, 'lng': -210.393375, 'temp': 18.21, 'hum': 59.12}];

      var map;
      function updateInfoPanel(id, temp, hum){
          $('#info').html(`ID: ${id}<br>Temperature: ${temp}&#176;C<br>Humidity: ${hum}%`);
          $('#notification_id_field').attr('data', id);
        }
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -37.090335, lng: 149.370666},
            zoom: 10,
            styles: [
              {
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#1d2c4d"
                  }
                ]
              },
              {
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#8ec3b9"
                  }
                ]
              },
              {
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#1a3646"
                  }
                ]
              },
              {
                "featureType": "administrative.country",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#4b6878"
                  }
                ]
              },
              {
                "featureType": "administrative.land_parcel",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#64779e"
                  }
                ]
              },
              {
                "featureType": "administrative.province",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#0b24d5"
                  }
                ]
              },
              {
                "featureType": "landscape.man_made",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#949a14"
                  }
                ]
              },
              {
                "featureType": "landscape.man_made",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#858b12"
                  }
                ]
              },
              {
                "featureType": "landscape.natural",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#1c7737"
                  }
                ]
              },
              {
                "featureType": "landscape.natural.landcover",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#31c440"
                  }
                ]
              },
              {
                "featureType": "landscape.natural.terrain",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#28a234"
                  },
                  {
                    "weight": 0.5
                  }
                ]
              },
              {
                "featureType": "poi",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#283d6a"
                  }
                ]
              },
              {
                "featureType": "poi",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#6f9ba5"
                  }
                ]
              },
              {
                "featureType": "poi",
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#1d2c4d"
                  }
                ]
              },
              {
                "featureType": "poi.park",
                "elementType": "geometry.fill",
                "stylers": [
                  {
                    "color": "#218b39"
                  }
                ]
              },
              {
                "featureType": "poi.park",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#6be642"
                  }
                ]
              },
              {
                "featureType": "road",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#c5c50a"
                  }
                ]
              },
              {
                "featureType": "road",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#98a5be"
                  }
                ]
              },
              {
                "featureType": "road",
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#1d2c4d"
                  }
                ]
              },
              {
                "featureType": "road.highway",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#b0d5ce"
                  }
                ]
              },
              {
                "featureType": "road.highway",
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#023e58"
                  }
                ]
              },
              {
                "featureType": "transit",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#98a5be"
                  }
                ]
              },
              {
                "featureType": "transit",
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#1d2c4d"
                  }
                ]
              },
              {
                "featureType": "transit.line",
                "elementType": "geometry.fill",
                "stylers": [
                  {
                    "color": "#283d6a"
                  }
                ]
              },
              {
                "featureType": "transit.station",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#3a4762"
                  }
                ]
              },
              {
                "featureType": "water",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#10b4f1"
                  }
                ]
              },
              {
                "featureType": "water",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#4e6d70"
                  }
                ]
              }
            ]
        });

        var heat_map_data = [];
        var markers = [];
        for(var i = 0; i < arduino_json.length; i++) {
            var ard_id = arduino_json[i]['arduinoID'];
            console.log(arduino_json);
            var lat_lng = new google.maps.LatLng(arduino_json[i]['lat'], arduino_json[i]['lng']);
            var marker = new google.maps.Marker({
              position: lat_lng,
              map: map,
              temp: arduino_json[i]['temp'],
              hum: arduino_json[i]['hum'],
              id: arduino_json[i]['arduinoID']
            });
            marker.addListener('click', function() {
              updateInfoPanel(this.id, this.hum, this.temp);
            });
            heat_map_data.push({location:lat_lng, weight: arduino_json[i]["temp"]});

        }

        var heatmap = new google.maps.visualization.HeatmapLayer({
            data: heat_map_data,
            radius: 60,
            dissipating: true
        });
        heatmap.setMap(map);

      }



    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5X9ww7Fg0W4Wr9G0kpFZjtYQ4FsQJJ2s&callback=initMap&libraries=visualization"
    async defer></script>
    </div>
  </div>
  <div class="right" id="info-panel">
    <h1 id="earthtones-title"><img style="width:100%" src="static/images/logo2.png" alt="Earthtones Logo"></h1>
    <h2 id="earthtones-subtitle"><i>Remote Crisis Monitoring</i></h2>
    <hr>
    <div id="info">
      <p>Click on a station to see local data</p>

    </div>
    <div class="notifications">
      <form class="notification-form" action="/addPhone" method="POST">
        <input type="text" name="phoneNumber" placeholder="Phone Number">
        <input type="hidden" name="arduinoID" data="" id="notification_id_field">
        <input type="submit">
      </form>
    </div>
  </div>
</div>
  </body>
</html>
